schema:
  version: 2

event:
  name: send:mobile:event
  version: 1

types:
  $Payload:
    name:
      of: string
      is:
        - required
    createdAt:
      of: string
      is:
        - required
    properties:
      of: array($Property)
  $Identity:
    userId:
      of: long
      is:
        - required
  $Metadata:
    origin:
      of: string
      is:
        - required
  $Property:
    key:
      of: string
      is:
        - required
    value:
      of: string
      is:
        - required
    type:
      of: string
      is:
        - required

validation:
  payload:
    of: $Payload
    is:
      - required
  identity:
    of: $Identity
    is:
      - required
  metadata:
    of: $Metadata
    is:
      - required

streaming:
  database: mobile_events
  tables:
    user_events:
      session_id: $.id
      event_id: $.flowId
      event_name: $.payload.name
      created_at: $.payload.createdAt
      user_id: $.identity.userId
      origin: $.metadata.origin

    properties[$.payload.properties]:
      event_id: $.flowId
      key: '@.key'
      value: '@.value'
